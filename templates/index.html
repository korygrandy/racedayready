<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Raceday Ready</title>
    <!-- NEW: Favicon -->
    <link rel="icon" href="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2050%2050'%3E%3Cpath%20fill='white'%20d='M25,5%20C10,5%205,20%205,30%20C5,45%2015,45%2025,45%20C35,45%2045,45%2045,30%20C45,20%2040,5%2025,5%20Z'%3E%3C/path%3E%3C/svg%3E">
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Custom CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body class="bg-body text-text-primary transition-colors duration-300">

    <div id="app-container" class="h-screen flex flex-col font-sans">

        <main class="flex-grow w-full p-4 overflow-y-auto">
            <div class="w-full max-w-6xl mx-auto">
                <!-- View container for toggling between app and dev mode -->
                <div id="main-view" class="w-full text-center py-16">
                    <h1 id="main-heading" class="text-4xl md:text-5xl font-bold mb-4">Hello World!</h1>
                    <p id="main-subheading" class="text-xl md:text-2xl mb-8">Welcome to Raceday Ready!</p>
                    <button id="ready-button" class="px-8 py-4 bg-blue-500 text-white font-semibold rounded-lg shadow-lg hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-all duration-300 ease-in-out transform hover:-translate-y-1">
                        Click to get ready!
                    </button>
                </div>

                <!-- Features View -->
                <div id="features-view" class="w-full max-w-6xl mx-auto hidden text-center py-16">
                    <div class="absolute top-4 left-4 flex items-center space-x-4">
                        <div id="profile-header-btn" class="flex items-center space-x-4 cursor-pointer p-2 rounded-lg hover:bg-interactive-hover" title="Change Profile">
                            <div id="features-helmet-display" class="w-12 h-12"></div>
                            <span id="features-username" class="text-lg font-semibold"></span>
                        </div>
                        <button id="theme-switcher-btn" class="p-2 rounded-full hover:bg-interactive-hover" title="Toggle Theme">
                            <!-- Icons will be injected by JS -->
                        </button>
                    </div>
                    <h1 id="features-heading" class="text-4xl md:text-5xl font-bold mb-8">Raceday Ready Features</h1>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                        <!-- Cards -->
                        <div id="feature-card-1" class="bg-card p-6 rounded-lg shadow-lg hover:bg-interactive-hover cursor-pointer"><h2 class="text-xl font-bold mb-2">Race Day Preparation & Logistics</h2></div>
                        <div id="feature-card-2" class="bg-card p-6 rounded-lg shadow-lg inactive-card"><h2 class="text-xl font-bold mb-2">Vehicle Management</h2></div>
                        <div id="feature-card-3" class="bg-card p-6 rounded-lg shadow-lg inactive-card"><h2 class="text-xl font-bold mb-2">Data Analysis & History</h2></div>
                        <div id="feature-card-4" class="bg-card p-6 rounded-lg shadow-lg inactive-card"><h2 class="text-xl font-bold mb-2">Social & Community Features</h2></div>
                        <div id="feature-card-5" class="bg-card p-6 rounded-lg shadow-lg inactive-card"><h2 class="text-xl font-bold mb-2">Engagement & Motivation</h2></div>
                        <div id="feature-card-6" class="bg-card p-6 rounded-lg shadow-lg hover:bg-interactive-hover cursor-pointer"><h2 class="text-xl font-bold mb-2">Garage Management</h2></div>
                        <div id="feature-card-7" class="bg-card p-6 rounded-lg shadow-lg hover:bg-interactive-hover cursor-pointer"><h2 class="text-xl font-bold mb-2">Upcoming Features</h2></div>
                    </div>
                </div>

                <!-- Race Day Prep View -->
                <div id="race-day-prep-view" class="w-full max-w-6xl mx-auto hidden text-center py-16">
                    <h1 class="text-4xl md:text-5xl font-bold mb-8">Race Day Preparation & Logistics</h1>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div id="race-schedule-card" class="bg-card p-6 rounded-lg shadow-lg inactive-card"><h2 class="text-xl font-bold mb-2">Race Schedule</h2></div>
                        <div id="automated-tasks-card" class="bg-card p-6 rounded-lg shadow-lg inactive-card"><h2 class="text-xl font-bold mb-2">Automated Tasks & Schedules</h2></div>
                        <div id="track-info-card" class="bg-card p-6 rounded-lg shadow-lg inactive-card"><h2 class="text-xl font-bold mb-2">Track Information Management</h2></div>
                    </div>
                    <button id="back-to-features-btn" class="mt-8 px-6 py-2 bg-gray-600 text-white font-semibold rounded-lg shadow-md hover:bg-gray-500">
                        Back to Features
                    </button>
                </div>

                <!-- NEW: Garage Management View -->
                <div id="garage-management-view" class="w-full max-w-4xl mx-auto hidden text-center py-16">
                    <h1 class="text-4xl md:text-5xl font-bold mb-8">Garage Management</h1>
                    <div class="bg-card p-8 rounded-lg shadow-lg text-left">
                        <h2 class="text-2xl font-bold mb-4">Add a New Garage</h2>
                        <form id="add-garage-form">
                            <label for="garage-name-input" class="block text-sm font-medium">Garage Name</label>
                            <input type="text" id="garage-name-input" maxlength="25" class="mt-1 block w-full bg-input border border-border rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500" required>
                            <button id="add-garage-btn" type="submit" class="mt-4 w-full bg-blue-500 text-white font-semibold py-2 px-4 rounded-lg shadow-md hover:bg-blue-600">Add Garage</button>
                        </form>
                    </div>
                    <div class="mt-8 bg-card p-8 rounded-lg shadow-lg text-left">
                        <h2 class="text-2xl font-bold mb-4">My Garages</h2>
                        <div id="garage-list" class="space-y-4">
                            <!-- Garages will be loaded here -->
                        </div>
                    </div>
                    <button id="back-to-features-from-garage-btn" class="mt-8 px-6 py-2 bg-gray-600 text-white font-semibold rounded-lg shadow-md hover:bg-gray-500">
                        Back to Features
                    </button>
                </div>

                <!-- Upcoming Features View -->
                <div id="upcoming-features-view" class="w-full max-w-4xl mx-auto hidden text-center py-16">
                    <h1 class="text-4xl md:text-5xl font-bold mb-8">Upcoming Features & Requests</h1>

                    <div id="critical-features-section" class="mb-8 bg-yellow-900/30 border border-yellow-700 p-6 rounded-lg shadow-lg text-left">
                        <h2 class="text-2xl font-bold text-yellow-300 mb-4">Critical Upcoming Features</h2>
                        <p class="text-yellow-400 mb-4">Based on our goals, here are the top three features we should prioritize:</p>
                        <ol class="list-decimal list-inside space-y-3">
                            <li><strong>Advanced Race Day Checklists:</strong> Create dynamic, template-based checklists for pre-race, mid-day, and post-race activities to ensure nothing is missed.</li>
                            <li><strong>Tire Management Module:</strong> A dedicated section to track tire sets, heat cycles, pressures, and performance notes to optimize usage and on-track results.</li>
                            <li><strong>Basic Telemetry Integration:</strong> Allow users to upload data from popular lap timers (e.g., AiM, VBOX) to view key metrics and link them to session notes.</li>
                        </ol>
                    </div>

                    <div class="bg-card p-8 rounded-lg shadow-lg text-left">
                        <h2 class="text-2xl font-bold mb-4">Submit a Feature Request</h2>
                        <p class="text-text-secondary mb-6">Have an idea for a new feature? Let us know!</p>
                        <form id="feature-request-form">
                            <textarea id="feature-request-textarea" rows="4" maxlength="500" class="w-full bg-input border border-border rounded-md p-2" placeholder="Describe your feature idea..."></textarea>
                            <div class="text-right text-sm text-text-secondary mt-1"><span id="char-counter">0 / 500</span></div>
                            <button id="submit-feature-request-btn" type="submit" class="mt-4 w-full bg-blue-500 text-white font-semibold py-2 px-4 rounded-lg shadow-md hover:bg-blue-600">Submit Request</button>
                        </form>
                    </div>

                    <div id="existing-requests-section" class="mt-8 bg-card p-8 rounded-lg shadow-lg text-left">
                        <h2 class="text-2xl font-bold mb-4">Existing Requests</h2>
                        <div id="feature-request-list" class="space-y-4">
                        </div>
                    </div>

                     <button id="back-to-features-from-upcoming-btn" class="mt-8 px-6 py-2 bg-gray-600 text-white font-semibold rounded-lg shadow-md hover:bg-gray-500">
                        Back to Features
                    </button>
                </div>

                <div id="developer-view" class="w-full max-w-4xl mx-auto hidden text-left p-4">
                    <h2 id="developer-view-heading" class="text-3xl font-bold mb-6 border-b border-border pb-2">Developer Mode</h2>

                    <div id="admin-section" class="mb-8">
                        <h3 class="text-2xl font-semibold mb-3">Administration</h3>
                        <div class="bg-card-darker p-4 rounded-lg shadow space-y-6">
                            <div>
                                <h4 class="font-bold text-lg">User Profile Limit</h4>
                                <p class="mt-2 text-text-secondary">Set the maximum number of user profiles (1-20).</p>
                                <div class="mt-4 flex items-center space-x-4">
                                    <input type="number" id="profile-limit-input" min="1" max="20" class="w-24 bg-input border border-border rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                                    <button id="update-profile-limit-btn" class="px-4 py-2 bg-blue-600 text-white font-semibold rounded-lg shadow-md hover:bg-blue-700">Update</button>
                                </div>
                            </div>
                            <div>
                                <h4 class="font-bold text-lg">Feature Request Settings</h4>
                                <div class="mt-4 space-y-4">
                                    <div class="flex items-center space-x-4">
                                        <input type="number" id="feature-request-limit-input" min="1" max="50" class="w-24 bg-input border border-border rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                                        <label for="feature-request-limit-input">Set the maximum number of requests (1-50).</label>
                                    </div>
                                    <div class="relative flex items-start">
                                        <div class="flex items-center h-5">
                                            <input id="enable-deletion-checkbox" type="checkbox" class="focus:ring-blue-500 h-4 w-4 text-blue-600 border-border rounded">
                                        </div>
                                        <div class="ml-3 text-sm">
                                            <label for="enable-deletion-checkbox" class="font-medium">Enable deletion of feature requests.</label>
                                        </div>
                                    </div>
                                    <div class="flex items-center space-x-4">
                                        <button id="update-feature-settings-btn" class="px-4 py-2 bg-blue-600 text-white font-semibold rounded-lg shadow-md hover:bg-blue-700">Update Settings</button>
                                        <button id="manage-feature-requests-link" class="text-sm text-blue-500 hover:underline">Manage Requests &rarr;</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div id="readme-section" class="mb-8">
                        <h3 id="readme-heading" class="text-2xl font-semibold mb-3">Developer Readme</h3>
                        <div class="bg-card-darker p-4 rounded-lg shadow">
                            <h4 id="readme-subheading" class="font-bold text-lg">How to Run the Application</h4>
                            <p class="mt-2 text-text-secondary">To run this Flask application locally, ensure you have Python and the required packages (`Flask`, `firebase-admin`) installed. Navigate to the project's root directory in your terminal and execute the following command:</p>
                            <pre id="readme-code-block" class="bg-input p-2 rounded mt-2 text-text-secondary"><code>py app.py</code></pre>
                        </div>
                    </div>

                    <div id="changelog-section" class="mb-8">
                        <h3 id="changelog-heading" class="text-2xl font-semibold mb-3">Changelog</h3>
                        <div class="space-y-4">
                            <div class="bg-card-darker p-4 rounded-lg shadow">
                                <h4 class="font-bold text-lg">Version 1.6.4 (August 8, 2025)</h4>
                                <ul class="list-disc list-inside mt-2 text-text-secondary space-y-1">
                                    <li>Enhanced Garage Management to allow users to edit and delete their garages.</li>
                                </ul>
                            </div>
                             <div class="bg-card-darker p-4 rounded-lg shadow">
                                <h4 class="font-bold text-lg">Version 1.6.3 (August 8, 2025)</h4>
                                <ul class="list-disc list-inside mt-2 text-text-secondary space-y-1">
                                    <li>Added the initial Garage Management feature, allowing users to add and view garages associated with their profile.</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <div id="defect-resolutions-section" class="mb-8">
                        <h3 id="defect-resolutions-heading" class="text-2xl font-semibold mb-3">Defect Resolutions</h3>
                        <div class="space-y-4">
                             <div id="defect-entry-messaging" class="bg-card-darker p-4 rounded-lg shadow">
                                <h4 class="font-bold text-lg">UI Message Box Not Displaying (Fixed: Aug 8, 2025) - v1.5.9</h4>
                                <p class="mt-2 text-text-secondary">
                                    <strong>Resolution:</strong> The message box element was moved in the HTML structure to prevent it from being affected by the layout properties of its parent container. This ensures that feedback messages are always visible to the user after an action is performed.
                                </p>
                            </div>
                        </div>
                    </div>

                     <button id="back-to-app-btn" class="mt-8 px-6 py-2 bg-blue-600 text-white font-semibold rounded-lg shadow-md hover:bg-blue-700">Back to App</button>
                </div>
            </div>
        </main>

        <div id="footer-container" class="w-full text-center p-4">
            <button id="dev-mode-btn" class="text-sm text-blue-500 hover:underline mb-2">Developer Mode</button>
            <footer class="text-sm text-text-secondary flex flex-col items-center space-y-1 w-full max-w-4xl mx-auto">
                <span id="footer-text">Built with Python (Flask), Tailwind CSS, and Gemini 2.5 Pro</span>
                <div class="flex space-x-4">
                    <span id="footer-updated">Last Updated: {{ last_updated }}</span>
                    <span id="footer-version">Version {{ app_version }}</span>
                </div>
            </footer>
        </div>
    </div>

    <div id="message-box" class="fixed bottom-24 right-4 bg-green-500 text-white py-2 px-4 rounded-lg shadow-lg opacity-0 transform translate-y-10 z-50"></div>

    <!-- Modals -->
    <div id="profile-modal" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center hidden z-40">
        <div class="bg-card p-8 rounded-lg shadow-2xl w-full max-w-md">
            <h2 class="text-2xl font-bold mb-4">Create Driver Profile</h2>
            <p class="text-text-secondary mb-6">Enter a username and choose a helmet color. The PIN is optional.</p>
            <form id="profile-form">
                <div class="space-y-4">
                    <div>
                        <label for="username-input" class="block text-sm font-medium">Username</label>
                        <input type="text" id="username-input" maxlength="12" class="mt-1 block w-full bg-input border border-border rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500" required>
                    </div>
                    <div>
                        <label for="helmet-color-input" class="block text-sm font-medium">Helmet Color</label>
                        <input type="color" id="helmet-color-input" value="#ffffff" class="mt-1 block w-full h-10">
                    </div>
                    <div>
                        <label for="theme-select" class="block text-sm font-medium">Theme</label>
                        <select id="theme-select" class="mt-1 block w-full bg-input border border-border rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                            <option value="dark">Dark</option>
                            <option value="light">Light</option>
                        </select>
                    </div>
                    <div class="relative flex items-start">
                        <div class="flex items-center h-5"><input id="enable-pin-checkbox" type="checkbox" class="focus:ring-blue-500 h-4 w-4 text-blue-600 border-border rounded"></div>
                        <div class="ml-3 text-sm"><label for="enable-pin-checkbox" class="font-medium">Enable 4-Digit PIN</label></div>
                    </div>
                    <div>
                        <label for="pin-input" class="block text-sm font-medium">4-Digit PIN</label>
                        <input type="password" id="pin-input" maxlength="4" pattern="[0-9]{4}" autocomplete="new-password" class="mt-1 block w-full bg-input border border-border rounded-md shadow-sm py-2 px-3 disabled:opacity-50" disabled>
                    </div>
                </div>
                <div class="mt-6 flex justify-end space-x-4">
                    <button id="cancel-create-btn" type="button" class="px-4 py-2 bg-gray-600 text-white font-semibold rounded-lg hover:bg-gray-500">Cancel</button>
                    <button id="save-profile-btn" type="submit" class="px-4 py-2 bg-blue-500 text-white font-semibold rounded-lg shadow-md hover:bg-blue-600">Save Profile</button>
                </div>
            </form>
        </div>
    </div>

    <div id="select-profile-modal" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center hidden z-40">
        <div class="bg-card p-8 rounded-lg shadow-2xl w-full max-w-md">
            <h2 class="text-2xl font-bold mb-4">Select Driver Profile</h2>
            <div id="profile-list" class="space-y-2 mb-6"></div>
            <button id="add-new-profile-btn" class="w-full bg-green-600 text-white font-semibold py-2 px-4 rounded-lg shadow-md hover:bg-green-700">Add New Profile</button>
        </div>
    </div>

    <div id="delete-confirm-modal" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center hidden z-40">
        <div class="bg-card p-8 rounded-lg shadow-2xl w-full max-w-md">
            <h2 class="text-2xl font-bold mb-4">Confirm Deletion</h2>
            <p class="text-text-secondary mb-6" id="delete-confirm-text"></p>
            <div class="flex justify-end space-x-4">
                <button id="cancel-delete-btn" class="px-4 py-2 bg-gray-600 text-white font-semibold rounded-lg hover:bg-gray-500">Cancel</button>
                <button id="confirm-delete-btn" class="px-4 py-2 bg-red-600 text-white font-semibold rounded-lg hover:bg-red-700">Yes, Delete</button>
            </div>
        </div>
    </div>

    <div id="pin-entry-modal" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center hidden z-40">
        <div class="bg-card p-8 rounded-lg shadow-2xl w-full max-w-md">
            <h2 class="text-2xl font-bold mb-4">Enter PIN</h2>
            <p class="text-text-secondary mb-6" id="pin-entry-text"></p>
            <form id="pin-entry-form">
                <input type="password" id="pin-entry-input" maxlength="4" autocomplete="off" class="block w-full text-center text-2xl tracking-[1em] bg-input border border-border rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                <div class="mt-6 flex justify-end space-x-4">
                    <button id="cancel-pin-entry-btn" type="button" class="px-4 py-2 bg-gray-600 text-white font-semibold rounded-lg hover:bg-gray-500">Cancel</button>
                    <button id="submit-pin-btn" type="submit" class="px-4 py-2 bg-blue-500 text-white font-semibold rounded-lg shadow-md hover:bg-blue-600">Submit</button>
                </div>
            </form>
        </div>
    </div>

    <div id="dev-pin-entry-modal" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center hidden z-40">
        <div class="bg-card p-8 rounded-lg shadow-2xl w-full max-w-md">
            <h2 class="text-2xl font-bold mb-4">Developer Access</h2>
            <p class="text-text-secondary mb-6">Please enter the PIN to access Developer Mode.</p>
            <form id="dev-pin-entry-form">
                <input type="password" id="dev-pin-entry-input" maxlength="4" autocomplete="new-password" class="block w-full text-center text-2xl tracking-[1em] bg-input border border-border rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                <div class="mt-6 flex justify-end space-x-4">
                    <button id="cancel-dev-pin-btn" type="button" class="px-4 py-2 bg-gray-600 text-white font-semibold rounded-lg hover:bg-gray-500">Cancel</button>
                    <button id="submit-dev-pin-btn" type="submit" class="px-4 py-2 bg-blue-500 text-white font-semibold rounded-lg shadow-md hover:bg-blue-600">Submit</button>
                </div>
            </form>
        </div>
    </div>

    <div id="pin-settings-modal" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center hidden z-40">
        <div class="bg-card p-8 rounded-lg shadow-2xl w-full max-w-md">
            <h2 class="text-2xl font-bold mb-4" id="pin-settings-heading"></h2>
            <form id="pin-settings-form">
                <div class="space-y-4">
                    <div class="relative flex items-start">
                        <div class="flex items-center h-5"><input id="edit-enable-pin-checkbox" type="checkbox" class="focus:ring-blue-500 h-4 w-4 text-blue-600 border-border rounded"></div>
                        <div class="ml-3 text-sm"><label for="edit-enable-pin-checkbox" class="font-medium">Enable 4-Digit PIN</label></div>
                    </div>
                    <div>
                        <label for="edit-pin-input" class="block text-sm font-medium">New 4-Digit PIN</label>
                        <input type="password" id="edit-pin-input" maxlength="4" pattern="[0-9]{4}" autocomplete="new-password" class="mt-1 block w-full bg-input border border-border rounded-md shadow-sm py-2 px-3 disabled:opacity-50" disabled>
                    </div>
                </div>
                <div class="mt-6 flex justify-end space-x-4">
                    <button id="cancel-pin-settings-btn" type="button" class="px-4 py-2 bg-gray-600 text-white font-semibold rounded-lg hover:bg-gray-500">Cancel</button>
                    <button id="save-pin-settings-btn" type="submit" class="px-4 py-2 bg-blue-500 text-white font-semibold rounded-lg shadow-md hover:bg-blue-600">Save Settings</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Custom JavaScript -->
    <script type="module" src="{{ url_for('static', filename='js/main.js') }}"></script>

</body>
</html>